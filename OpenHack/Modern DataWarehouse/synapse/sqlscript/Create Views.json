{
	"name": "Create Views",
	"properties": {
		"folder": {
			"name": "Star Schema"
		},
		"content": {
			"query": "--CREATE schema star;\n\nDROP VIEW star.DimActor;\nGO\nCREATE VIEW star.DimActor\nAS\nSELECT\n    ActorSK,\n    ActorId,\n    [Name] as ActorName,\n    '' as ActorGender\nFROM dbo.Actors;\nGO\n\nDROP VIEW star.DimCategories;\nGO\nCREATE VIEW star.DimCategories\nAS\nSELECT \n    ROW_NUMBER() OVER (ORDER BY MovieCategoryDescription desc) as MovieCategorySK,\n    MovieCategoryDescription\nFROM \n(\n    SELECT DISTINCT Genre as MovieCategoryDescription\n    FROM dbo.Movies\n)Categories;\nGO\n\nDROP VIEW star.DimCustomers;\nGO\nCREATE VIEW star.DimCustomers\nAS\nSELECT \n    CustomerSK,\n    c.CustomerID,\n    c.LastName,\n    c.FirstName,\n    a.AddressLine1,\n    a.AddressLine2,\n    a.City,\n    a.State,\n    a.ZipCode,\n    c.PhoneNumber,\n    c.CreatedDate as RecordStartDate,\n    c.UpdatedDate as RecordEndDate\nFROM dbo.Customers c\nLEFT JOIN dbo.Addresses a on c.CustomerID = a.CustomerID\n    and c.DataSourceId = a.DataSourceId\nGO\n\nDROP VIEW star.DimDate;\nGO\nCREATE VIEW star.DimDate\nAS\nSELECT \n     [DateSK]\n    ,[DateValue]\n    ,[DateYear]\n    ,[DateMonth]\n    ,[DateDay]\n    ,[DateDayOfWeek]\n    ,[DateDayOfYear]\n    ,[DateWeekOfYear]\nFROM [dbo].[DimDate]\nGO\n\nDROP VIEW star.DimLocation;\nGO\nCREATE VIEW star.DimLocation\nAS\nSELECT \n    1 as LocationSK,\n    'Southridge' as LocationName, \n    1 as Streaming,\n    0 as Rentals,\n    1 as Sales\nUNION ALL\nSELECT\n    2 as LocationSK,\n    'VanArsdel' as LocationName, \n    0 as Streaming,\n    1 as Rentals,\n    0 as Sales\nUNION ALL\nSELECT\n    3 as LocationSK,\n    'FourthCofee' as LocationName, \n    0 as Streaming,\n    1 as Rentals,\n    0 as Sales\nGO\n\nDROP VIEW star.DimMovieActors;\nGO\nCREATE View star.DimMovieActors\nAS\nSELECT\n    MovieId,\n    ActorId\nFROM dbo.MovieActors\nGO\n\nDROP VIEW star.DimMovies;\nGO\nCREATE VIEW star.DimMovies\nAS\nSELECT\n    m.MovieSK,\n    m.MovieId,\n    m.Title as MovieTitle,\n    c.MovieCategorySK,\n    r.MovieRatingSK,\n    m.Runtime as MovieRunTimeMin\nFROM dbo.Movies m\nLEFT JOIN star.DimCategories c on m.Genre = c.MovieCategoryDescription\nLEFT JOIN star.DimRatings r on m.Rating = r.MovieRatingDescription\nGO\n\nDROP VIEW star.DimRatings;\nGO\nCREATE VIEW star.DimRatings\nAS\nSELECT\n    ROW_NUMBER() OVER (ORDER BY Rating desc) as MovieRatingSK,\n    Rating as MovieRatingDescription\nFROM\n(\n    SELECT DISTINCT Rating\n    FROM dbo.Movies\n\n)ratings\nGO\n\nDROP VIEW star.DimTime;\nGO\nCREATE VIEW star.DimTime\nAS\nSELECT \n    [TimeSK]\n    ,[TimeValue]\n    ,[TimeHour]\n    ,[TimeMinute]\n    ,[TimeSecond]\n    ,[TimeMinuteOfDay]\n    ,[TimeSecondOfDay]\n FROM [dbo].[DimTime]",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "Southridge",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}